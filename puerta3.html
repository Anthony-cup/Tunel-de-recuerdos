<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>Galer√≠a P√©talos de Rosa</title>
<style>
:root{--rose1:#ff6b9d;--rose2:#ffa8cc;--rose3:#ff85a2;--gold:#ffd700;--bg1:#1a0d1a;--bg2:#2d1b2d}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:Inter,sans-serif;color:#fff;background:radial-gradient(ellipse at center,var(--bg2) 20%,var(--bg1) 80%);overflow-x:hidden;touch-action:manipulation}

/* Fondo m√°gico con estrellas */
.stars{position:fixed;inset:0;pointer-events:none;z-index:1}
.star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;opacity:.6;animation:twinkle 3s infinite}
@keyframes twinkle{0%,100%{opacity:.3;transform:scale(1)}50%{opacity:1;transform:scale(1.3)}}

/* Header minimalista */
.header{position:fixed;top:0;left:0;right:0;z-index:200;padding:20px;display:flex;justify-content:space-between;align-items:center;background:linear-gradient(180deg,rgba(45,27,45,.9),transparent);backdrop-filter:blur(10px)}
.back-btn{background:linear-gradient(135deg,var(--rose1),var(--rose2));border:none;color:#fff;padding:12px 24px;border-radius:30px;font-weight:600;cursor:pointer;box-shadow:0 6px 20px rgba(255,107,157,.3);transition:all .3s ease}
.back-btn:hover{transform:translateY(-3px);box-shadow:0 10px 30px rgba(255,107,157,.5)}
.hint{font-size:12px;color:#ffb3d9;opacity:.9;max-width:180px;text-align:right}

/* Contenedor principal */
.main{position:relative;z-index:10;min-height:100vh;padding:100px 20px 60px;display:flex;align-items:center;justify-content:center}

/* Galer√≠a en forma de coraz√≥n */
.gallery{width:100%;max-width:500px;position:relative;display:grid;grid-template-areas:"a b c""d e f""g g g";grid-template-columns:1fr 1fr 1fr;grid-template-rows:120px 120px 100px;gap:15px;transform:perspective(800px) rotateX(5deg)}

.card{position:relative;border-radius:25px;overflow:hidden;background:linear-gradient(145deg,rgba(255,255,255,.05),rgba(255,107,157,.08));backdrop-filter:blur(8px);box-shadow:0 10px 40px rgba(0,0,0,.4),inset 0 2px 4px rgba(255,255,255,.1);cursor:pointer;opacity:0;transform:scale(0) rotateY(180deg);transition:all .8s cubic-bezier(.68,-.55,.265,1.55)}

.card:nth-child(1){grid-area:a}.card:nth-child(2){grid-area:b}.card:nth-child(3){grid-area:c}
.card:nth-child(4){grid-area:d}.card:nth-child(5){grid-area:e}.card:nth-child(6){grid-area:f}
.card:nth-child(7){grid-area:g;border-radius:35px}

.card img{width:100%;height:100%;object-fit:cover;transition:transform 1s ease,filter .6s ease}

/* P√©talos de rosa */
.petal{position:absolute;width:12px;height:18px;background:linear-gradient(45deg,var(--rose1),var(--rose2));border-radius:50% 50% 50% 50% / 60% 60% 40% 40%;opacity:.8;pointer-events:none;z-index:150}

/* Animaciones de p√©talos */
@keyframes fallPetal{0%{transform:translateY(-20px) rotateZ(0deg) rotateX(0deg);opacity:0}10%{opacity:.9}90%{opacity:.7}100%{transform:translateY(120vh) rotateZ(720deg) rotateX(360deg);opacity:0}}

.petal.falling{animation:fallPetal 4s ease-in forwards}

/* Estados de las fotos */
.card:hover,.card.blooming{transform:scale(1.05) rotateY(0deg);box-shadow:0 20px 60px rgba(255,107,157,.3),0 0 30px rgba(255,168,204,.2)}
.card:hover img,.card.blooming img{transform:scale(1.1);filter:brightness(1.15) saturate(1.3)}

/* Efecto de floraci√≥n */
.card.revealed{opacity:1;transform:scale(1) rotateY(0deg)}

/* Brillo dorado */
.card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,215,0,.1) 0%,transparent 30%,transparent 70%,rgba(255,107,157,.1) 100%);opacity:0;transition:opacity .5s ease;border-radius:inherit;z-index:1}
.card:hover::before,.card.blooming::before{opacity:1}

/* Efecto de destello */
.card::after{content:'';position:absolute;top:-100%;left:-100%;width:300%;height:300%;background:linear-gradient(45deg,transparent 30%,rgba(255,255,255,.2) 50%,transparent 70%);transform:rotate(45deg);opacity:0;transition:all .6s ease;pointer-events:none}
.card:hover::after{opacity:1;animation:sparkle 2s ease infinite}
@keyframes sparkle{0%{transform:translateX(-300%) translateY(-300%) rotate(45deg)}100%{transform:translateX(300%) translateY(300%) rotate(45deg)}}

/* Animaciones autom√°ticas suaves */
@keyframes breathe{0%,100%{transform:scale(1) translateY(0)}50%{transform:scale(1.02) translateY(-3px)}}
@keyframes gentleGlow{0%,100%{box-shadow:0 10px 40px rgba(0,0,0,.4)}50%{box-shadow:0 15px 50px rgba(255,107,157,.2)}}

.card.auto-breathe{animation:breathe 6s ease-in-out infinite}
.card.auto-glow{animation:gentleGlow 4s ease-in-out infinite}

/* Mariposas rom√°nticas */
.butterfly{position:absolute;width:20px;height:15px;background:linear-gradient(45deg,var(--rose2),var(--gold));border-radius:50% 50% 50% 50% / 60% 60% 40% 40%;opacity:.7;pointer-events:none;z-index:100}
.butterfly::before{content:'';position:absolute;left:8px;width:12px;height:12px;background:linear-gradient(45deg,var(--rose1),var(--rose3));border-radius:50% 50% 50% 50% / 60% 60% 40% 40%}
@keyframes flyButterfly{0%{transform:translateX(0) translateY(0) rotate(0deg)}25%{transform:translateX(30px) translateY(-20px) rotate(10deg)}75%{transform:translateX(-20px) translateY(-10px) rotate(-5deg)}100%{transform:translateX(0) translateY(0) rotate(0deg)}}

/* Modal rom√°ntico */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(26,13,26,.95),rgba(45,27,45,.95));backdrop-filter:blur(25px);z-index:1000;padding:20px}
.modal.show{display:flex}
.modal-content{max-width:90vw;max-height:85vh;position:relative;border-radius:25px;overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,.8),0 0 50px rgba(255,107,157,.2)}
.modal img{width:100%;height:100%;object-fit:contain;border-radius:25px}
.modal-close{position:absolute;top:20px;right:20px;background:rgba(0,0,0,.8);border:none;color:#fff;width:40px;height:40px;border-radius:50%;cursor:pointer;font-size:20px;z-index:1001}

/* Bot√≥n m√°gico flotante */
.magic-btn{position:fixed;bottom:30px;right:30px;z-index:150;background:linear-gradient(135deg,var(--gold),var(--rose1));border:none;color:#fff;width:65px;height:65px;border-radius:50%;cursor:pointer;box-shadow:0 10px 30px rgba(255,215,0,.4);transition:all .3s ease;display:flex;align-items:center;justify-content:center;font-size:28px}
.magic-btn:hover{transform:scale(1.15) rotate(360deg);box-shadow:0 15px 40px rgba(255,215,0,.6)}

/* Loading elegante */
.loading{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--bg1),var(--bg2));z-index:9999}
.loading-content{text-align:center;color:var(--rose2)}
.rose-spinner{width:60px;height:60px;border:4px solid rgba(255,168,204,.2);border-top:4px solid var(--rose2);border-radius:50%;animation:spin 1.5s ease-in-out infinite;margin:0 auto 20px}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

.credits{position:fixed;bottom:15px;left:50%;transform:translateX(-50%);font-size:11px;color:rgba(255,179,217,.7);text-align:center}

/* Responsive */
@media(min-width:768px){.gallery{max-width:600px;grid-template-rows:140px 140px 120px;gap:20px}}
</style>
</head>
<body>
<div class="loading" id="loading">
<div class="loading-content">
<div class="rose-spinner"></div>
<h3>üåπ Creando jard√≠n rom√°ntico...</h3>
<p>Preparando p√©talos m√°gicos</p>
</div>
</div>

<div class="stars" id="stars"></div>
<div class="header">
<button class="back-btn" id="backBtn">‚Üê Regresar</button>
<div class="hint">Toca para ver la magia üåπ</div>
</div>

<div class="main">
<div class="gallery" id="gallery"></div>
</div>

<button class="magic-btn" id="magicBtn">üåπ</button>

<div class="modal" id="modal">
<div class="modal-content">
<button class="modal-close" id="closeModal">√ó</button>
<img id="modalImg" alt="Vista m√°gica"/>
</div>
</div>

<div class="credits">Los p√©talos revelan momentos especiales ‚Ä¢ Toca para ampliar ü¶ã</div>

<script type="module">
import{initializeApp}from'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
import{getDatabase,ref,get}from'https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js';

const firebaseConfig={apiKey:"AIzaSyBk2SVaP1w4V3MWrpp1r3X5Xk9eH06gBt4",authDomain:"tunel-de-recuerdos.firebaseapp.com",projectId:"tunel-de-recuerdos",storageBucket:"tunel-de-recuerdos.firebasestorage.app",messagingSenderId:"630660710506",appId:"1:630660710506:web:90d34150c9f21f668eca13"};
const app=initializeApp(firebaseConfig);const db=getDatabase(app);

let galleryData=[];let bloomIndex=0;
const loading=document.getElementById('loading');const gallery=document.getElementById('gallery');const modal=document.getElementById('modal');const modalImg=document.getElementById('modalImg');

function createStars(){const container=document.getElementById('stars');for(let i=0;i<30;i++){const star=document.createElement('div');star.className='star';star.style.left=Math.random()*100+'%';star.style.top=Math.random()*100+'%';star.style.animationDelay=Math.random()*3+'s';star.style.animationDuration=(2+Math.random()*2)+'s';container.appendChild(star)}}

function createPetalShower(targetCard,cardIndex){const rect=targetCard.getBoundingClientRect();const centerX=rect.left+rect.width/2;const centerY=rect.top+rect.height/2;

for(let i=0;i<25;i++){setTimeout(()=>{const petal=document.createElement('div');petal.className='petal falling';petal.style.left=(centerX-100+Math.random()*200)+'px';petal.style.top='-20px';petal.style.background=`linear-gradient(45deg,hsl(${320+Math.random()*40},80%,${60+Math.random()*20}%),hsl(${300+Math.random()*60},70%,${70+Math.random()*20}%))`;petal.style.animationDelay=(Math.random()*0.5)+'s';petal.style.animationDuration=(3+Math.random()*2)+'s';document.body.appendChild(petal);setTimeout(()=>petal.remove(),6000)},i*50)}

setTimeout(()=>{targetCard.classList.add('revealed');setTimeout(()=>{const sparkles=createSparkles(centerX,centerY);setTimeout(()=>sparkles.forEach(s=>s.remove()),2000)},300)},800)}

function createSparkles(x,y){const sparkles=[];for(let i=0;i<12;i++){const sparkle=document.createElement('div');sparkle.style.position='absolute';sparkle.style.left=x+'px';sparkle.style.top=y+'px';sparkle.style.width='4px';sparkle.style.height='4px';sparkle.style.background=`hsl(${40+Math.random()*20},90%,80%)`;sparkle.style.borderRadius='50%';sparkle.style.pointerEvents='none';sparkle.style.zIndex='200';document.body.appendChild(sparkle);
const angle=Math.random()*Math.PI*2;const distance=30+Math.random()*40;const endX=x+Math.cos(angle)*distance;const endY=y+Math.sin(angle)*distance;sparkle.animate([{transform:'translate(0,0) scale(1)',opacity:1},{transform:`translate(${endX-x}px,${endY-y}px) scale(0)`,opacity:0}],{duration:1500,easing:'ease-out'});sparkles.push(sparkle)}return sparkles}

function createButterfly(){const butterfly=document.createElement('div');butterfly.className='butterfly';butterfly.style.left=Math.random()*window.innerWidth+'px';butterfly.style.top=(200+Math.random()*300)+'px';butterfly.style.animation='flyButterfly 8s ease-in-out infinite';butterfly.style.animationDelay=Math.random()*4+'s';document.body.appendChild(butterfly);setTimeout(()=>butterfly.remove(),12000)}

async function fetchImages(userId){try{const snap=await get(ref(db,`usuarios/${userId}`));if(!snap.exists())return[];const data=snap.val();const imgs=data.puerta2Fotos||data.puertaFotos||data.fotos||data.images||[];return Array.isArray(imgs)?imgs.filter(u=>u&&u.trim()):[]}catch(e){return[]}}

function buildGallery(images){gallery.innerHTML='';galleryData=[];while(galleryData.length<7){images.forEach(img=>{if(galleryData.length<7)galleryData.push(img)});if(images.length===0)break}
if(galleryData.length===0){for(let i=1;i<=7;i++)galleryData.push(`https://picsum.photos/400/300?random=${i+20}`)}

galleryData.forEach((url,i)=>{const card=document.createElement('div');card.className='card';card.innerHTML=`<img src="${url}" alt="Momento ${i+1}" loading="lazy"/>`;card.addEventListener('click',()=>openModal(i));gallery.appendChild(card);setTimeout(()=>{const animations=['auto-breathe','auto-glow'];const randomAnim=animations[Math.floor(Math.random()*animations.length)];card.classList.add(randomAnim);card.querySelector('img').style.animationDelay=Math.random()*2+'s'},3000+i*600)});

startPetalReveal()}

function startPetalReveal(){const cards=document.querySelectorAll('.card');cards.forEach((card,i)=>{setTimeout(()=>{createPetalShower(card,i)},i*1000+500)})}

function startBloomCycle(){const cards=document.querySelectorAll('.card.revealed');if(cards.length===0)return;function cycle(){cards.forEach((card,i)=>{card.classList.toggle('blooming',i===bloomIndex)});bloomIndex=(bloomIndex+1)%cards.length}
cycle();setInterval(cycle,3000)}

function openModal(i){modalImg.src=galleryData[i];modal.classList.add('show');document.body.style.overflow='hidden'}
function closeModal(){modal.classList.remove('show');modalImg.src='';document.body.style.overflow=''}

function triggerMagic(){createButterfly();createButterfly();const cards=document.querySelectorAll('.card.revealed');cards.forEach((card,i)=>{setTimeout(()=>{card.style.transform='scale(1.08) rotate(5deg)';card.style.filter='brightness(1.25) saturate(1.4) hue-rotate(10deg)';setTimeout(()=>{card.style.transform='';card.style.filter=''},1200)},i*150)})}

document.getElementById('closeModal').addEventListener('click',closeModal);modal.addEventListener('click',e=>{if(e.target===modal)closeModal()});document.getElementById('backBtn').addEventListener('click',()=>{window.parent.postMessage({type:'doorClosed'},'*')});document.getElementById('magicBtn').addEventListener('click',triggerMagic);

async function init(){createStars();const urlParams=new URLSearchParams(window.location.search);const userId=urlParams.get('id')?.trim();let images=[];if(userId)images=await fetchImages(userId);if(images.length===0)images=Array.from({length:7},(_,i)=>`https://picsum.photos/400/300?random=${i+30}`);
setTimeout(()=>{loading.style.opacity='0';setTimeout(()=>{loading.style.display='none';buildGallery(images);setTimeout(()=>{startBloomCycle();setInterval(createButterfly,8000)},8000)},500)},1500)}

init();document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});
</script>
</body>
</html>
