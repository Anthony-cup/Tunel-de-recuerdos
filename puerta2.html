<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>Galer√≠a Rom√°ntica Autom√°tica</title>
<style>
:root{--bg1:#0a0511;--bg2:#1a0f2e;--pink:#ff9ec7;--blue:#87ceeb;--glow:#ff6b9d;}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:Inter,sans-serif;color:#fff;background:radial-gradient(ellipse at top,var(--bg2),var(--bg1));overflow-x:hidden;-webkit-font-smoothing:antialiased;touch-action:manipulation}

/* Part√≠culas rom√°nticas */
.particles{position:fixed;inset:0;pointer-events:none;z-index:1}
.particle{position:absolute;width:2px;height:2px;background:var(--pink);border-radius:50%;opacity:.5;animation:float 12s infinite ease-in-out}
@keyframes float{0%,100%{transform:translateY(0) rotate(0deg);opacity:.3}50%{transform:translateY(-30px) rotate(180deg);opacity:.8}}

/* Header con bot√≥n arriba */
.top-bar{position:fixed;top:0;left:0;right:0;z-index:200;padding:15px 20px;background:linear-gradient(180deg,rgba(26,15,46,.95),transparent);backdrop-filter:blur(15px);display:flex;justify-content:space-between;align-items:center}
.back-btn{background:linear-gradient(135deg,var(--pink),var(--blue));border:none;color:#fff;padding:10px 20px;border-radius:25px;font-weight:600;cursor:pointer;box-shadow:0 4px 15px rgba(255,107,157,.3);transition:all .3s ease}
.back-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(255,107,157,.5)}
.instruction{font-size:12px;color:#ffdfe8;text-align:center;opacity:.9;max-width:200px;line-height:1.3}

/* Fireworks para entrada */
.firework{position:absolute;width:4px;height:4px;background:var(--pink);border-radius:50%;pointer-events:none}
.firework-trail{position:absolute;width:2px;height:20px;background:linear-gradient(to top,var(--glow),transparent);border-radius:50%}

/* Galer√≠a principal */
.container{padding:80px 15px 80px;min-height:100vh;display:flex;align-items:center;justify-content:center}
.gallery{width:100%;max-width:450px;display:grid;grid-template-columns:1fr 1fr;gap:15px;position:relative}

/* Tarjetas de fotos con animaciones autom√°ticas */
.card{position:relative;border-radius:20px;overflow:hidden;background:linear-gradient(145deg,rgba(255,255,255,.08),rgba(255,255,255,.03));backdrop-filter:blur(8px);box-shadow:0 8px 32px rgba(0,0,0,.4),inset 0 1px 2px rgba(255,255,255,.1);transition:all .8s cubic-bezier(.23,1,.32,1);cursor:pointer}

.card:nth-child(1){aspect-ratio:3/4}
.card:nth-child(2){aspect-ratio:3/4}
.card:nth-child(3){grid-column:span 2;aspect-ratio:16/9}
.card:nth-child(4){aspect-ratio:3/4}
.card:nth-child(5){aspect-ratio:3/4}
.card:nth-child(6){grid-column:span 2;aspect-ratio:16/9}
.card:nth-child(7){grid-column:span 2;aspect-ratio:3/2}

.card img{width:100%;height:100%;object-fit:cover;transition:transform 1.2s ease,filter .8s ease;will-change:transform}

/* Animaciones autom√°ticas de zoom rom√°ntico */
@keyframes romanticZoom{0%{transform:scale(1) translate(0,0);filter:brightness(1) saturate(1)}25%{transform:scale(1.08) translate(-3px,-2px);filter:brightness(1.1) saturate(1.15)}75%{transform:scale(1.05) translate(2px,-1px);filter:brightness(1.05) saturate(1.1)}100%{transform:scale(1) translate(0,0);filter:brightness(1) saturate(1)}}

@keyframes gentleFloat{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-8px) scale(1.02)}}

@keyframes pulseGlow{0%,100%{box-shadow:0 8px 32px rgba(0,0,0,.4),0 0 20px rgba(255,158,199,.1)}50%{box-shadow:0 12px 40px rgba(255,107,157,.3),0 0 30px rgba(255,158,199,.2)}}

/* Aplicar animaciones autom√°ticas */
.card.auto-zoom img{animation:romanticZoom 8s ease-in-out infinite}
.card.auto-float{animation:gentleFloat 6s ease-in-out infinite}
.card.auto-glow{animation:pulseGlow 4s ease-in-out infinite}

/* Overlay rom√°ntico */
.card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,158,199,.08) 0%,transparent 40%,transparent 60%,rgba(135,206,235,.08) 100%);opacity:0;transition:opacity .5s ease;z-index:1}
.card:hover::before,.card.active::before{opacity:1}

/* Brillo sutil */
.card::after{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent 40%,rgba(255,255,255,.15) 50%,transparent 60%);transform:rotate(45deg);opacity:0;transition:all .6s ease;pointer-events:none}
.card:hover::after{opacity:1;animation:shine 2s ease infinite}
@keyframes shine{0%{transform:translateX(-100%) translateY(-100%) rotate(45deg)}100%{transform:translateX(100%) translateY(100%) rotate(45deg)}}

/* Estados activos */
.card:hover,.card.spotlight{transform:translateY(-5px) scale(1.02);box-shadow:0 20px 40px rgba(255,107,157,.25),0 8px 32px rgba(0,0,0,.6)}
.card:hover img,.card.spotlight img{transform:scale(1.1);filter:brightness(1.15) saturate(1.2)}

/* Corazones flotantes */
.hearts{position:fixed;inset:0;pointer-events:none;z-index:50}
.heart{position:absolute;color:var(--glow);font-size:16px;opacity:.8;animation:floatHeart 8s linear infinite}
@keyframes floatHeart{0%{transform:translateY(100vh) rotate(0deg);opacity:0}10%,90%{opacity:.8}100%{transform:translateY(-50px) rotate(360deg);opacity:0}}

/* Modal rom√°ntico */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(135deg,rgba(10,5,17,.98),rgba(26,15,46,.98));backdrop-filter:blur(20px);z-index:1000;padding:20px}
.modal.show{display:flex}
.modal-content{max-width:90vw;max-height:80vh;position:relative;border-radius:20px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.8)}
.modal img{width:100%;height:100%;object-fit:contain;border-radius:20px}
.modal-close{position:absolute;top:15px;right:15px;background:rgba(0,0,0,.8);border:none;color:#fff;width:35px;height:35px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:18px;z-index:1001}

/* Bot√≥n sorpresa flotante */
.surprise-btn{position:fixed;bottom:30px;right:30px;z-index:150;background:linear-gradient(135deg,var(--glow),var(--blue));border:none;color:#fff;width:60px;height:60px;border-radius:50%;cursor:pointer;box-shadow:0 8px 25px rgba(255,107,157,.4);transition:all .3s ease;display:flex;align-items:center;justify-content:center;font-size:24px}
.surprise-btn:hover{transform:scale(1.1);box-shadow:0 12px 35px rgba(255,107,157,.6)}

/* Loading suave */
.loading{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--bg1),var(--bg2));z-index:9999;transition:opacity .5s ease}
.loading-content{text-align:center;color:var(--pink)}
.spinner{width:40px;height:40px;border:3px solid rgba(255,158,199,.3);border-top:3px solid var(--pink);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 15px}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* Animaci√≥n de revelaci√≥n */
@keyframes revealCard{0%{transform:scale(0) rotate(180deg);opacity:0}60%{transform:scale(1.1) rotate(-10deg);opacity:1}100%{transform:scale(1) rotate(0deg);opacity:1}}

/* Entrada suave - inicialmente invisibles */
.card{opacity:0;transform:scale(0);transition:all .8s cubic-bezier(.23,1,.32,1)}

.credits{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);font-size:11px;color:rgba(255,223,232,.6);text-align:center}

@media(min-width:768px){.gallery{max-width:700px;grid-template-columns:repeat(3,1fr);gap:18px}}
</style>
</head>
<body>
<div class="loading" id="loading"><div class="loading-content"><div class="spinner"></div><h3>Cargando momentos rom√°nticos...</h3></div></div>
<div class="particles" id="particles"></div>
<div class="top-bar"><button class="back-btn" id="backBtn">‚Üê Regresar</button><div class="instruction">Presiona regresar para ver el siguiente ‚ú®</div></div>
<div class="hearts" id="hearts"></div>
<div class="container"><div class="gallery" id="gallery"></div></div>
<button class="surprise-btn" id="surpriseBtn">üíñ</button>
<div class="modal" id="modal"><div class="modal-content"><button class="modal-close" id="closeModal">√ó</button><img id="modalImg" alt="Vista ampliada"/></div></div>
<div class="credits">Las fotos cambian autom√°ticamente ‚Ä¢ Toca para ampliar</div>

<script type="module">
import{initializeApp}from'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
import{getDatabase,ref,get}from'https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js';

const firebaseConfig={apiKey:"AIzaSyBk2SVaP1w4V3MWrpp1r3X5Xk9eH06gBt4",authDomain:"tunel-de-recuerdos.firebaseapp.com",projectId:"tunel-de-recuerdos",storageBucket:"tunel-de-recuerdos.firebasestorage.app",messagingSenderId:"630660710506",appId:"1:630660710506:web:90d34150c9f21f668eca13"};
const app=initializeApp(firebaseConfig);const db=getDatabase(app);

let galleryData=[];let spotlightIndex=0;
const loading=document.getElementById('loading');const gallery=document.getElementById('gallery');const modal=document.getElementById('modal');const modalImg=document.getElementById('modalImg');

function launchFirework(targetX,targetY,cardIndex){const container=document.getElementById('particles');const startX=Math.random()*window.innerWidth;const startY=window.innerHeight+20;const fw=document.createElement('div');fw.className='firework';fw.style.left=startX+'px';fw.style.top=startY+'px';fw.style.background=`hsl(${320+Math.random()*60},80%,70%)`;container.appendChild(fw);
const trail=document.createElement('div');trail.className='firework-trail';trail.style.left=startX+'px';trail.style.top=startY+'px';container.appendChild(trail);
const duration=1200;const startTime=Date.now();function animate(){const elapsed=Date.now()-startTime;const progress=elapsed/duration;if(progress>=1){fw.remove();trail.remove();explodeAndReveal(targetX,targetY,cardIndex);return}
const currentX=startX+(targetX-startX)*progress;const currentY=startY+(targetY-startY)*progress;fw.style.left=currentX+'px';fw.style.top=currentY+'px';trail.style.left=currentX+'px';trail.style.top=currentY+'px';requestAnimationFrame(animate)}animate()}

function explodeAndReveal(x,y,cardIndex){const container=document.getElementById('particles');for(let i=0;i<15;i++){const spark=document.createElement('div');spark.style.position='absolute';spark.style.width='3px';spark.style.height='3px';spark.style.background=`hsl(${300+Math.random()*80},85%,70%)`;spark.style.borderRadius='50%';spark.style.left=x+'px';spark.style.top=y+'px';spark.style.pointerEvents='none';container.appendChild(spark);
const angle=Math.random()*Math.PI*2;const speed=2+Math.random()*4;const vx=Math.cos(angle)*speed;const vy=Math.sin(angle)*speed;let opacity=1;function animateSpark(){spark.style.left=parseFloat(spark.style.left)+vx+'px';spark.style.top=parseFloat(spark.style.top)+vy+'px';opacity-=0.02;spark.style.opacity=opacity;if(opacity<=0){spark.remove();return}requestAnimationFrame(animateSpark)}animateSpark()}
setTimeout(()=>{const card=document.querySelectorAll('.card')[cardIndex];if(card){card.style.opacity='1';card.style.transform='scale(0)';card.style.animation='revealCard .8s cubic-bezier(.68,-.55,.265,1.55) forwards'}},200)}

function createHearts(){const container=document.getElementById('hearts');const heartTypes=['üíñ','üíï','üíó','üíò','üíù','üíû','‚ù§Ô∏è'];for(let i=0;i<6;i++){const h=document.createElement('div');h.className='heart';h.textContent=heartTypes[Math.floor(Math.random()*heartTypes.length)];h.style.left=Math.random()*100+'%';h.style.animationDelay=Math.random()*8+'s';h.style.animationDuration=(6+Math.random()*4)+'s';container.appendChild(h);setTimeout(()=>{if(h.parentNode)h.parentNode.removeChild(h)},10000)}}

async function fetchImages(userId){try{const snap=await get(ref(db,`usuarios/${userId}`));if(!snap.exists())return[];const data=snap.val();const imgs=data.puerta2Fotos||data.puertaFotos||data.fotos||data.images||[];return Array.isArray(imgs)?imgs.filter(u=>u&&u.trim()):[]}catch(e){return[]}}

function buildGallery(images){gallery.innerHTML='';galleryData=[];while(galleryData.length<7){images.forEach(img=>{if(galleryData.length<7)galleryData.push(img)});if(images.length===0)break}
if(galleryData.length===0){for(let i=1;i<=7;i++)galleryData.push(`https://picsum.photos/600/800?random=${i}`)}

galleryData.forEach((url,i)=>{const card=document.createElement('div');card.className='card';card.innerHTML=`<img src="${url}" alt="Foto ${i+1}" loading="lazy"/>`;card.addEventListener('click',()=>openModal(i));gallery.appendChild(card);setTimeout(()=>{const animations=['auto-zoom','auto-float','auto-glow'];const randomAnim=animations[Math.floor(Math.random()*animations.length)];card.classList.add(randomAnim);card.querySelector('img').style.animationDelay=Math.random()*3+'s';card.querySelector('img').style.animationDuration=(6+Math.random()*4)+'s'},2000+i*800)});

startFireworkSequence();setTimeout(()=>{startSpotlight();startAutoEffects()},8000)}

function startFireworkSequence(){const cards=document.querySelectorAll('.card');cards.forEach((card,i)=>{setTimeout(()=>{const rect=card.getBoundingClientRect();const targetX=rect.left+rect.width/2;const targetY=rect.top+rect.height/2;launchFirework(targetX,targetY,i)},i*800+1000)})}

function startSpotlight(){const cards=document.querySelectorAll('.card');function cycle(){cards.forEach((card,i)=>{card.classList.toggle('spotlight',i===spotlightIndex)});spotlightIndex=(spotlightIndex+1)%cards.length}
cycle();setInterval(cycle,3500)}

function startAutoEffects(){setTimeout(createHearts,2000);setInterval(createHearts,12000);setInterval(()=>{const cards=document.querySelectorAll('.card');cards.forEach((card,i)=>{setTimeout(()=>{card.style.transform='translateY(-8px) scale(1.03)';card.style.boxShadow='0 25px 50px rgba(255,107,157,.3)';setTimeout(()=>{card.style.transform='';card.style.boxShadow=''},1000)},i*150)})},20000)}

function openModal(i){modalImg.src=galleryData[i];modal.classList.add('show');document.body.style.overflow='hidden'}
function closeModal(){modal.classList.remove('show');modalImg.src='';document.body.style.overflow=''}

function triggerSurprise(){createHearts();const cards=document.querySelectorAll('.card');cards.forEach((card,i)=>{setTimeout(()=>{card.style.transform='scale(1.1) rotate(2deg)';card.style.filter='brightness(1.2) saturate(1.3)';setTimeout(()=>{card.style.transform='';card.style.filter=''},800)},i*100)})}

document.getElementById('closeModal').addEventListener('click',closeModal);modal.addEventListener('click',e=>{if(e.target===modal)closeModal()});document.getElementById('backBtn').addEventListener('click',()=>{window.parent.postMessage({type:'doorClosed'},'*')});document.getElementById('surpriseBtn').addEventListener('click',triggerSurprise);

async function init(){const urlParams=new URLSearchParams(window.location.search);const userId=urlParams.get('id')?.trim();let images=[];if(userId)images=await fetchImages(userId);if(images.length===0)images=Array.from({length:7},(_,i)=>`https://picsum.photos/600/800?random=${i+10}`);
setTimeout(()=>{loading.style.opacity='0';setTimeout(()=>{loading.style.display='none';buildGallery(images)},500)},1500)}

init();document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal()});
</script>
</body>
</html>
